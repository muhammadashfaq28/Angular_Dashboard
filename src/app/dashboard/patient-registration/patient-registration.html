<div class="container">
  <div class="row">
    <div class="col-6">
      <form [formGroup]="signUp" (submit)="handleSubmit()">

        <div class="form-group">
          <label>Name</label>
          <input type="text" class="form-control" formControlName="name" (keypress)="allowOnlyLetters($event)"
            (paste)="blockPaste($event)">
          @if (signUp.get('name')?.touched && signUp.get('name')?.errors) {
          <div class="text-danger">
            @if (signUp.get('name')?.errors?.['required']) {
            <div>Name is required</div>
            }
            @if (signUp.get('name')?.errors?.['pattern']) {
            <div>Name can only contain letters</div>
            }
          </div>
          }
        </div>

        <div class="form-group">
          <label> Gender </label>
          <input type="gender" class="form-control" formControlName="gender">
        </div>
        <div class="form-group">
          <label> Date of Birth </label>
          <input type="date" class="form-control" formControlName="dob">
        </div>

        <div class="form-group">
          <label>Age</label>
          <input type="number" class="form-control" formControlName="age">

          @if(signUp.get('age')?.touched && signUp.get('age')?.errors){

          <div class="text-danger">
            @if(signUp.get('age')?.errors?.['min']){

            <div>You must be at least 18 years old</div>

            }
          </div>
          }
        </div>


        <div class="form-group">
          <label> Contact Number </label>
          <input type="contact" class="form-control" formControlName="number">
        </div>
        <div class="form-group">
          <label> Email </label>
          <input type="email" class="form-control" formControlName="email">
        </div>
        <div class="form-group">
          <label> Address </label>
          <input type="address" class="form-control" formControlName="address">
        </div>
        <div class="form-group">
          <label> City </label>
          <input type="dropdown" class="form-control" formControlName="city">
        </div>

        <div class="mb-3">
          <label for="bloodGroup" class="form-label">Blood Group</label>
          <select class="form-select" id="bloodGroup" formControlName="blood_group" required>
            <option value="">Choose...</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
          </select>
          <div class="text-danger mt-1"
            *ngIf="signUp.get('blood_group')?.touched && signUp.get('blood_group')?.errors?.['required']">
            Please select a blood group.
          </div>
        </div>

        <div class="form-group">
          <label>Allergies </label>
          <input type="text" class="form-control" formControlName="allergies">
        </div>
        <div class="form-group">
          <label>Existing Diesease </label>
          <input type="text" class="form-control" formControlName="existing_diseases">
        </div>
        <div class="form-group">
          <label>Ensurance Provider </label>
          <input type="text" class="form-control" formControlName="ensurance_provider">
        </div>
        <div class="form-group">
          <label>Ensurance Number </label>
          <input type="text" class="form-control" formControlName="insurance_number">
          @if(signUp.get('insurance_number')?.touched && signUp.get('insurance_number')?.errors?.['minlength']){
          <div class="text-danger">
            Insurance Number Must be At Least 4 digits
          </div>
          }
        </div>
        <br>

        <button type="submit" class="btn btn-danger mb-3" [disabled]="signUp.invalid">
          Submit
        </button>
      </form>
    </div>

    <hr>

    @if(patients.length > 0){
    <h3>Registered patients</h3>

    <div class="table-responsive">

      <table class="table table-bordered">

        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Gender</th>
            <th>DOB</th>
            <th>Age</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Address</th>
            <th>City</th>
            <th>Blood_group</th>
            <th>Allergies</th>
            <th>Existing_diseases</th>
            <th>Insurance_provider</th>
            <th>Insurance_number</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          @for(patient of patients; track $index; let i = $index){
          <tr>
            <td>{{i+1}}</td>
            <td>{{patient.name}}</td>
            <td>{{patient.gender}}</td>
            <td>{{patient.dob}}</td>
            <td>{{patient.age}}</td>
            <td>{{patient.number}}</td>
            <td>{{patient.email}}</td>
            <td>{{patient.address}}</td>
            <td>{{patient.city}}</td>
            <td>{{patient.blood_group}}</td>
            <td>{{patient.allergies}}</td>
            <td>{{patient.existing_diseases}}</td>
            <td>{{patient.ensurance_provider}}</td>
            <td>{{patient.insurance_number}}</td>

            <td>
              <button class="btn btn-sm btn-warning mb-1" (click)="editPatient(i)">
                Edit
              </button>

              <button class="btn btn-sm btn-danger" (click)="deletePatient(i)">
                Delete
              </button>
            </td>

          </tr>
          }
        </tbody>
      </table>

    </div>
    }


  </div>
</div>